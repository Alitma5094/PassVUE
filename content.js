chrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {
  if (request.action == "getPasses") {
    // const xmlStr =
    //   '<?xml version="1.0" encoding="utf-8"?>\r\n<REV_WDW_RESPONSE ACTION="Rev_Partial_Refresh">\r\n  <PARTIAL_DEF>\r\n    <REV_GROUP_BOX ID="APPROVAL_PENDING_CARDS_CONTAINER" LABEL="Approval Pending Cards" READ_ONLY="NO" SUPPRESS_HEADER="YES" TYPE="REV_GROUP_BOX" WIDTH="100%" PARTIAL="Y">\r\n    <REV_GROUP_BOX FROM_REGION="Y" SUPPRESS_HEADER="Y" TYPE="REV_GROUP_BOX" LABEL="Hall Pass Cards">\r\n      <REV_GROUP_BOX ID="HALL_PASS_CARD" TYPE="REV_GROUP_BOX" LABEL="Hall Pass Card">\r\n        <REV_STATIC_TEXT REV_TEXT="{&quot;HallPassID&quot;:&quot;7BF6A798-58E3-47D9-814F-14DD2D46026A&quot;,&quot;IconPath&quot;:&quot;Images/ST_GENESIS/HP_Restroom_48x48_3x.png&quot;,&quot;Color&quot;:&quot;#ff6614&quot;,&quot;Room&quot;:&quot;1-Bathroom&quot;,&quot;EndDateTime&quot;:{&quot;Year&quot;:2023,&quot;Month&quot;:11,&quot;Day&quot;:20,&quot;Hour&quot;:10,&quot;Minute&quot;:3,&quot;Second&quot;:45},&quot;StudentImage&quot;:&quot;Images/ST_GENESIS/Student.gif&quot;,&quot;StudentHasImage&quot;:false,&quot;StudentName&quot;:&quot;Jane Smith&quot;,&quot;StudentGrade&quot;:&quot;Grade 11&quot;,&quot;IsActive&quot;:false,&quot;IsApprovalPending&quot;:true,&quot;IsWaiting&quot;:false,&quot;IssueDateTime&quot;:&quot;9:55 AM&quot;,&quot;Minutes&quot;:&quot;8 minutes&quot;}" />\r\n      </REV_GROUP_BOX>\r\n      <REV_GROUP_BOX ID="HALL_PASS_CARD" TYPE="REV_GROUP_BOX" LABEL="Hall Pass Card">\r\n        <REV_STATIC_TEXT REV_TEXT="{&quot;HallPassID&quot;:&quot;0DCD92FD-535F-44E5-90AB-969E3F9B3231&quot;,&quot;IconPath&quot;:&quot;Images/ST_GENESIS/HP_Restroom_48x48_3x.png&quot;,&quot;Color&quot;:&quot;#ff6614&quot;,&quot;Room&quot;:&quot;1-Bathroom&quot;,&quot;EndDateTime&quot;:{&quot;Year&quot;:2023,&quot;Month&quot;:11,&quot;Day&quot;:20,&quot;Hour&quot;:10,&quot;Minute&quot;:5,&quot;Second&quot;:24},&quot;StudentImage&quot;:&quot;Photos/A3/A3839D90-6D0C-41A7-B210-DE01EECE5D67_Photo.PNG&quot;,&quot;StudentHasImage&quot;:true,&quot;StudentName&quot;:&quot;John Doe&quot;,&quot;StudentGrade&quot;:&quot;Grade 10&quot;,&quot;IsActive&quot;:false,&quot;IsApprovalPending&quot;:true,&quot;IsWaiting&quot;:false,&quot;IssueDateTime&quot;:&quot;9:57 AM&quot;,&quot;Minutes&quot;:&quot;8 minutes&quot;}" />\r\n      </REV_GROUP_BOX>\r\n    </REV_GROUP_BOX>\r\n  </REV_GROUP_BOX>\r\n  </PARTIAL_DEF>\r\n  <PASS_THROUGH ParentViewGU="" ParentViewClientID="PrimaryView" />\r\n  <REV_DATA_ROOT>\r\n    <REV_VIEW PRIMARY_OBJECT="98793600-BE92-4209-B5CD-C948D094BEFF" GUID="74A85F4C-8B11-46D0-8503-336DAD1DAB8E">\r\n      <REV_TAB GUID="F7F4EF27-C332-4DD1-A8D6-B367E6CE42F9" />\r\n      <REV_TAB GUID="FFE2D3C2-F27C-41A1-A7B5-AEE6EA6FEBC3" />\r\n      <REV_TAB GUID="50CED152-F164-436E-A094-9D6637EB8BD6" />\r\n      <REV_TAB GUID="AD1245BA-486A-4E4F-9E3F-995139E82765" />\r\n    </REV_VIEW>\r\n    <SCROLL_FIELDS />\r\n    <IDENTITY />\r\n    <GROUP_FIELDS />\r\n    <CLIENT_STATE>\r\n      <CLIENT_ACTION TYPE="Server_State">\r\n        <SERVER_STATE>\r\n          <D K="STUDENTS" V="40301017-6C4E-4B1D-98F2-0A442860506C,85D4E362-8F2D-4FA8-AE8B-1546C26C7122,146BFC92-A5DE-4795-9322-1A11F7CC303D,2F8C9EC1-2422-42E7-8B74-3310554AA2E5,ACF7D0D0-A259-4242-BE1E-3D434B2C5ECB,D929677B-98A7-45BB-912F-59449843A20E,27751F61-6D9E-49DB-BB97-59DB466C80FC,58ADD56A-31F9-4823-9BD7-5B3F961EB00A,9F463E57-8172-42FD-AA8C-69130C25283D,9AC511ED-9C14-4ACA-ACD3-69DFC9991411,EEED5AA1-0C48-4FB6-BDFD-6CFF4A9434F2,94C00995-2682-47CA-A560-6D498C32F3BA,392FB1AE-15F4-4B4F-BB36-706CC955194D,8BB63704-E660-4C1E-BB6B-7B32A4700996,ACF6E5F7-CD1B-4AF9-BABC-83D3EA638C4C,F5B97419-4878-4C72-B662-853B9610B0AE,E4E93FD5-CC17-4424-866F-8CA981FB72F3,A63B14AD-6198-4E37-AC99-92FBB01056D4,9B5FCE51-4ABF-4691-B3E8-93A872A50FD9,3D24CE9E-0BD8-4411-BFBA-A3D6955EED47,3BA3BFE6-529F-432E-BCA0-A7906CAF5F74,194756E9-390C-47DF-B6F5-A8EE6121F5A4,36012CDF-E2D0-4B0A-973D-B03027436E76,62261CF2-C9FE-40C0-BDC0-B4C67FE3D634,988EEC66-55A0-4A12-8B7E-BEF869F4BB4D,21ECFFF6-E32C-4943-BB7D-D102284DBA85,C92A7784-F122-40AD-93C0-D6AB4B039D22,A7E950C7-3693-4AD0-9D72-D71E048705FA,6EFCACFC-E1FB-4E82-893A-D9CA72F977DC,F3C1BE2C-8731-40CB-A3DE-DFAA43754951,BD9E34FC-D232-4988-919F-E3D84B044CB1" />\r\n          <D K="_LAST_READ_" V="11/20/2023 10:01:29 AM" />\r\n          <D K="ShowAllStudents" V="Y" />\r\n          <D K="FROM_TXP" V="Y" />\r\n          <D K="CurrentWebPortal" V="TeacherVUE" />\r\n        </SERVER_STATE>\r\n      </CLIENT_ACTION>\r\n    </CLIENT_STATE>\r\n  </REV_DATA_ROOT>\r\n</REV_WDW_RESPONSE>';
    requestHandler(sendResponse);
    return true;
  }
});

const requestHandler = async (sendResponse) => {
  const xmlStr =
    '<?xml version="1.0" encoding="utf-8"?>\r\n<REV_WDW_RESPONSE ACTION="Rev_Partial_Refresh">\r\n  <PARTIAL_DEF>\r\n    <REV_GROUP_BOX ID="APPROVAL_PENDING_CARDS_CONTAINER" LABEL="Approval Pending Cards" READ_ONLY="NO" SUPPRESS_HEADER="YES" TYPE="REV_GROUP_BOX" WIDTH="100%" PARTIAL="Y">\r\n    <REV_GROUP_BOX FROM_REGION="Y" SUPPRESS_HEADER="Y" TYPE="REV_GROUP_BOX" LABEL="Hall Pass Cards">\r\n      <REV_GROUP_BOX ID="HALL_PASS_CARD" TYPE="REV_GROUP_BOX" LABEL="Hall Pass Card">\r\n        <REV_STATIC_TEXT REV_TEXT="{&quot;HallPassID&quot;:&quot;7BF6A798-58E3-47D9-814F-14DD2D46026A&quot;,&quot;IconPath&quot;:&quot;Images/ST_GENESIS/HP_Restroom_48x48_3x.png&quot;,&quot;Color&quot;:&quot;#ff6614&quot;,&quot;Room&quot;:&quot;1-Bathroom&quot;,&quot;EndDateTime&quot;:{&quot;Year&quot;:2023,&quot;Month&quot;:11,&quot;Day&quot;:20,&quot;Hour&quot;:10,&quot;Minute&quot;:3,&quot;Second&quot;:45},&quot;StudentImage&quot;:&quot;Images/ST_GENESIS/Student.gif&quot;,&quot;StudentHasImage&quot;:false,&quot;StudentName&quot;:&quot;Jane Smith&quot;,&quot;StudentGrade&quot;:&quot;Grade 11&quot;,&quot;IsActive&quot;:false,&quot;IsApprovalPending&quot;:true,&quot;IsWaiting&quot;:false,&quot;IssueDateTime&quot;:&quot;9:55 AM&quot;,&quot;Minutes&quot;:&quot;8 minutes&quot;}" />\r\n      </REV_GROUP_BOX>\r\n      <REV_GROUP_BOX ID="HALL_PASS_CARD" TYPE="REV_GROUP_BOX" LABEL="Hall Pass Card">\r\n        <REV_STATIC_TEXT REV_TEXT="{&quot;HallPassID&quot;:&quot;0DCD92FD-535F-44E5-90AB-969E3F9B3231&quot;,&quot;IconPath&quot;:&quot;Images/ST_GENESIS/HP_Restroom_48x48_3x.png&quot;,&quot;Color&quot;:&quot;#ff6614&quot;,&quot;Room&quot;:&quot;1-Bathroom&quot;,&quot;EndDateTime&quot;:{&quot;Year&quot;:2023,&quot;Month&quot;:11,&quot;Day&quot;:20,&quot;Hour&quot;:10,&quot;Minute&quot;:5,&quot;Second&quot;:24},&quot;StudentImage&quot;:&quot;Photos/A3/A3839D90-6D0C-41A7-B210-DE01EECE5D67_Photo.PNG&quot;,&quot;StudentHasImage&quot;:true,&quot;StudentName&quot;:&quot;John Doe&quot;,&quot;StudentGrade&quot;:&quot;Grade 10&quot;,&quot;IsActive&quot;:false,&quot;IsApprovalPending&quot;:true,&quot;IsWaiting&quot;:false,&quot;IssueDateTime&quot;:&quot;9:57 AM&quot;,&quot;Minutes&quot;:&quot;8 minutes&quot;}" />\r\n      </REV_GROUP_BOX>\r\n    </REV_GROUP_BOX>\r\n  </REV_GROUP_BOX>\r\n  </PARTIAL_DEF>\r\n  <PASS_THROUGH ParentViewGU="" ParentViewClientID="PrimaryView" />\r\n  <REV_DATA_ROOT>\r\n    <REV_VIEW PRIMARY_OBJECT="98793600-BE92-4209-B5CD-C948D094BEFF" GUID="74A85F4C-8B11-46D0-8503-336DAD1DAB8E">\r\n      <REV_TAB GUID="F7F4EF27-C332-4DD1-A8D6-B367E6CE42F9" />\r\n      <REV_TAB GUID="FFE2D3C2-F27C-41A1-A7B5-AEE6EA6FEBC3" />\r\n      <REV_TAB GUID="50CED152-F164-436E-A094-9D6637EB8BD6" />\r\n      <REV_TAB GUID="AD1245BA-486A-4E4F-9E3F-995139E82765" />\r\n    </REV_VIEW>\r\n    <SCROLL_FIELDS />\r\n    <IDENTITY />\r\n    <GROUP_FIELDS />\r\n    <CLIENT_STATE>\r\n      <CLIENT_ACTION TYPE="Server_State">\r\n        <SERVER_STATE>\r\n          <D K="STUDENTS" V="40301017-6C4E-4B1D-98F2-0A442860506C,85D4E362-8F2D-4FA8-AE8B-1546C26C7122,146BFC92-A5DE-4795-9322-1A11F7CC303D,2F8C9EC1-2422-42E7-8B74-3310554AA2E5,ACF7D0D0-A259-4242-BE1E-3D434B2C5ECB,D929677B-98A7-45BB-912F-59449843A20E,27751F61-6D9E-49DB-BB97-59DB466C80FC,58ADD56A-31F9-4823-9BD7-5B3F961EB00A,9F463E57-8172-42FD-AA8C-69130C25283D,9AC511ED-9C14-4ACA-ACD3-69DFC9991411,EEED5AA1-0C48-4FB6-BDFD-6CFF4A9434F2,94C00995-2682-47CA-A560-6D498C32F3BA,392FB1AE-15F4-4B4F-BB36-706CC955194D,8BB63704-E660-4C1E-BB6B-7B32A4700996,ACF6E5F7-CD1B-4AF9-BABC-83D3EA638C4C,F5B97419-4878-4C72-B662-853B9610B0AE,E4E93FD5-CC17-4424-866F-8CA981FB72F3,A63B14AD-6198-4E37-AC99-92FBB01056D4,9B5FCE51-4ABF-4691-B3E8-93A872A50FD9,3D24CE9E-0BD8-4411-BFBA-A3D6955EED47,3BA3BFE6-529F-432E-BCA0-A7906CAF5F74,194756E9-390C-47DF-B6F5-A8EE6121F5A4,36012CDF-E2D0-4B0A-973D-B03027436E76,62261CF2-C9FE-40C0-BDC0-B4C67FE3D634,988EEC66-55A0-4A12-8B7E-BEF869F4BB4D,21ECFFF6-E32C-4943-BB7D-D102284DBA85,C92A7784-F122-40AD-93C0-D6AB4B039D22,A7E950C7-3693-4AD0-9D72-D71E048705FA,6EFCACFC-E1FB-4E82-893A-D9CA72F977DC,F3C1BE2C-8731-40CB-A3DE-DFAA43754951,BD9E34FC-D232-4988-919F-E3D84B044CB1" />\r\n          <D K="_LAST_READ_" V="11/20/2023 10:01:29 AM" />\r\n          <D K="ShowAllStudents" V="Y" />\r\n          <D K="FROM_TXP" V="Y" />\r\n          <D K="CurrentWebPortal" V="TeacherVUE" />\r\n        </SERVER_STATE>\r\n      </CLIENT_ACTION>\r\n    </CLIENT_STATE>\r\n  </REV_DATA_ROOT>\r\n</REV_WDW_RESPONSE>';
  // const response = await fetch(
  //   "https://md-hcpss.edupoint.com/Service/RTCommunication.asmx/XMLDoRequest?PORTAL=1",
  //   {
  //     headers: {
  //       accept: "application/xml, text/xml, */*; q=0.01",
  //       "accept-language": "en-US,en;q=0.9",
  //       "content-type": "application/x-www-form-urlencoded; charset=UTF-8",
  //       current_web_portal: "undefined",
  //       "sec-ch-ua":
  //         '"Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24"',
  //       "sec-ch-ua-mobile": "?0",
  //       "sec-ch-ua-platform": '"Windows"',
  //       "sec-fetch-dest": "empty",
  //       "sec-fetch-mode": "cors",
  //       "sec-fetch-site": "same-origin",
  //       "x-requested-with": "XMLHttpRequest",
  //     },
  //     referrer: "https://md-hcpss.edupoint.com/ST_Content.aspx",
  //     body: "xml=%3CREV_REQUEST%3E%3CEVENT+NAME%3D%22Rev_Partial_Refresh%22%3E%3CREQUEST+FOCUS_KEY%3D%22267DFD11-953E-450D-948E-EC71A81A8D53%22+WINDOW_ID%3D%22NewWindow2%22+FROM_TXP%3D%22Y%22%3E%3CREV_ACTIONS+FOCUS_KEY%3D%22267DFD11-953E-450D-948E-EC71A81A8D53%22%3E%3CREV_DATA_ROOT+FOCUS_KEY%3D%22267DFD11-953E-450D-948E-EC71A81A8D53%22+VIEW_TYPE%3D%22BOUND%22+VIEW_GUID%3D%2274A85F4C-8B11-46D0-8503-336DAD1DAB8E%22+ORIGINAL_VIEW_GUID%3D%2274A85F4C-8B11-46D0-8503-336DAD1DAB8E%22+ACTION%3D%22PARTIAL_REFRESH%22+PRIMARY_OBJECT%3D%2298793600-BE92-4209-B5CD-C948D094BEFF%22+REV_VIEW_TYPE%3D%22REV_DATA_ENTRY%22+CUR_TAB_GUID%3D%2250CED152-F164-436E-A094-9D6637EB8BD6%22+MODE%3D%22Normal%22%3E%3CREV_DATA_REQUEST%3E%3CREV_VIEW+GUID%3D%2274A85F4C-8B11-46D0-8503-336DAD1DAB8E%22%3E%3CREV_TAB+GUID%3D%2250CED152-F164-436E-A094-9D6637EB8BD6%22%2F%3E%3C%2FREV_VIEW%3E%3CREV_ELEMENT+ALIAS%3D%22ShowAllStudents%22+SRC_NAME%3D%22K12-ScheduleInfo-HallPassUI-ShowAllStudents%22+SRC_OBJECT%3D%22HallPassUI%22+SRC_OBJECT_GUID%3D%2298793600-BE92-4209-B5CD-C948D094BEFF%22+SRC_ELEMENT%3D%22ShowAllStudents%22%3E%3C!%5BCDATA%5BY%5D%5D%3E%3C%2FREV_ELEMENT%3E%3C%2FREV_DATA_REQUEST%3E%3CIDENTITY%2F%3E%3CREV_DATA_GROUP%3E%3CREV_ELEMENT+ALIAS%3D%22ShowAllStudents%22+SRC_NAME%3D%22K12-ScheduleInfo-HallPassUI-ShowAllStudents%22+SRC_OBJECT%3D%22HallPassUI%22+SRC_OBJECT_GUID%3D%2298793600-BE92-4209-B5CD-C948D094BEFF%22+SRC_ELEMENT%3D%22ShowAllStudents%22%3E%3C!%5BCDATA%5BY%5D%5D%3E%3C%2FREV_ELEMENT%3E%3C%2FREV_DATA_GROUP%3E%3CPARTIAL_REFRESH%3E%3CREV_ELEMENT+GUID%3D%22APPROVAL_PENDING_CARDS_CONTAINER%22%3E%3C%2FREV_ELEMENT%3E%3C%2FPARTIAL_REFRESH%3E%3CSCROLL_FIELDS%3E%3C%2FSCROLL_FIELDS%3E%3C%2FREV_DATA_ROOT%3E%3C%2FREV_ACTIONS%3E%3CSERVER_STATE%3E%3CD+K%3D%22STUDENTS%22+V%3D%2240301017-6C4E-4B1D-98F2-0A442860506C%2C85D4E362-8F2D-4FA8-AE8B-1546C26C7122%2C146BFC92-A5DE-4795-9322-1A11F7CC303D%2C2F8C9EC1-2422-42E7-8B74-3310554AA2E5%2CACF7D0D0-A259-4242-BE1E-3D434B2C5ECB%2CD929677B-98A7-45BB-912F-59449843A20E%2C27751F61-6D9E-49DB-BB97-59DB466C80FC%2C58ADD56A-31F9-4823-9BD7-5B3F961EB00A%2C9F463E57-8172-42FD-AA8C-69130C25283D%2C9AC511ED-9C14-4ACA-ACD3-69DFC9991411%2CEEED5AA1-0C48-4FB6-BDFD-6CFF4A9434F2%2C94C00995-2682-47CA-A560-6D498C32F3BA%2C392FB1AE-15F4-4B4F-BB36-706CC955194D%2C8BB63704-E660-4C1E-BB6B-7B32A4700996%2CACF6E5F7-CD1B-4AF9-BABC-83D3EA638C4C%2CF5B97419-4878-4C72-B662-853B9610B0AE%2CE4E93FD5-CC17-4424-866F-8CA981FB72F3%2CA63B14AD-6198-4E37-AC99-92FBB01056D4%2C9B5FCE51-4ABF-4691-B3E8-93A872A50FD9%2C3D24CE9E-0BD8-4411-BFBA-A3D6955EED47%2C3BA3BFE6-529F-432E-BCA0-A7906CAF5F74%2C194756E9-390C-47DF-B6F5-A8EE6121F5A4%2C36012CDF-E2D0-4B0A-973D-B03027436E76%2C62261CF2-C9FE-40C0-BDC0-B4C67FE3D634%2C988EEC66-55A0-4A12-8B7E-BEF869F4BB4D%2C21ECFFF6-E32C-4943-BB7D-D102284DBA85%2CC92A7784-F122-40AD-93C0-D6AB4B039D22%2CA7E950C7-3693-4AD0-9D72-D71E048705FA%2C6EFCACFC-E1FB-4E82-893A-D9CA72F977DC%2CF3C1BE2C-8731-40CB-A3DE-DFAA43754951%2CBD9E34FC-D232-4988-919F-E3D84B044CB1%22%2F%3E%3CD+K%3D%22_LAST_READ_%22+V%3D%2211%2F20%2F2023+10%3A01%3A29+AM%22%2F%3E%3CD+K%3D%22ShowAllStudents%22+V%3D%22Y%22%2F%3E%3CD+K%3D%22FROM_TXP%22+V%3D%22Y%22%2F%3E%3CD+K%3D%22CurrentWebPortal%22+V%3D%22TeacherVUE%22%2F%3E%3C%2FSERVER_STATE%3E%3CPASS_THROUGH+ParentViewGU%3D%22%22+ParentViewClientID%3D%22PrimaryView%22%2F%3E%3C%2FREQUEST%3E%3C%2FEVENT%3E%3C%2FREV_REQUEST%3E",
  //     method: "POST",
  //     mode: "cors",
  //     credentials: "include",
  //   }
  // );
  // const xmlStr = await response.text();
  const parser = new DOMParser();
  const doc = parser.parseFromString(xmlStr, "text/xml");
  var hall_passes = [];
  doc.querySelectorAll("REV_STATIC_TEXT").forEach((element) => {
    hall_passes.push(JSON.parse(element.attributes.REV_TEXT.value));
  });
  sendResponse({
    data: hall_passes,
  });
};
